var n,t,i;function o(e,t){var i=e.attr("song"),o=e.text();e.attr("artist");(n=new Audio("/audio/voicedata/wav/"+i)).currentTime||$(".duration").html("0.00"),("player1"==t?$("#audio-player1 .title"):$("#audio-player2 .title")).text(o)}function r(o){$(n).bind("timeupdate",function(){var e=parseInt(n.currentTime%60),t=parseInt(n.currentTime/60%60);e<10&&(e="0"+e);var i=0;0<n.currentTime&&(i=Math.floor(100/n.duration*n.currentTime)),1==o?($("#duration1").html(t+"."+e),$("#progress1").css("width",i+"%"),n.duration==n.currentTime&&($("#duration1").html("0.00"),$("#pause1").hide(),$("#play1").show(),$("#progress1").removeAttr("curtime"))):2==o&&($("#duration2").html(t+"."+e),$("#progress2").css("width",i+"%"),n.duration==n.currentTime&&($("#duration2").html("0.00"),$("#pause2").hide(),$("#play2").show(),$("#progress2").removeAttr("curtime")))})}function h(e,t,i,o,n,r,a,s){var l=new FormData,c=$(".setting-btn").attr("set");e&&l.append("image",e),c&&l.append("setval",c),validAudioList&&0<$(".uploadAudioList")[0].files.length&&(e=$(".uploadAudioList")[0].files[0],l.append("audiolist",e)),validScoreFile&&0<$(".uploadAudioScore")[0].files.length&&(e=$(".uploadAudioScore")[0].files[0],l.append("audioscore",e));c=$("#randomizeToggle").prop("checked"),e=$("#shuffleToggle").prop("checked"),s=s||"";l.append("randomization",c?"randomize":e?"shuffle":"sequential"),l.append("multiplecheckbox",t),l.append("choicestxt",i),l.append("instructiontxt",o),l.append("samepoint",n),l.append("differentpoint",r),l.append("set",a),l.append("addop",s),localStorage.removeItem("temp"),$(".loader").show(),$.ajax({url:URL+"settings",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:l,contentType:!1,processData:!1}).done(function(e){$(".loader").hide(),"success"==Object.keys(e)[0]?location.reload():"error"==Object.keys(e)[0]&&($(".errortxt").text(e.error),$(".errordiv").css("display","block"),$("#settingModal").scrollTop(1e3))}).fail(function(e){$(".loader").hide(),console.log(e)})}function a(e,i,o,n){var e=e.split(","),r=$.Deferred();return $.each(e,function(e,t){if($.trim(t.toLowerCase())===$.trim(i.toLowerCase()))return o.text("Setting name already exists!"),n.css("display","block"),r.reject(),!1}),r.resolve(),r.promise()}function s(){$(".setting-btn").addClass("dropdown-toggle"),$(".setting-btn").prop("contenteditable",!1),$(".setting-btn").attr("data-toggle","dropdown"),$(".setting-btn").css("cursor","pointer"),$(".rename-set").show(),$(".add-set").show(),$(".downloadreport").show(),$(".done-rename").hide(),$(".cancel-rename").hide(),$(".settingdropdown .dropdown-menu").removeAttr("style")}function l(){lv_store=startlv,score=0,counter=1,localStorage.setItem("score",score),localStorage.setItem("counter",counter),localStorage.setItem("prevscore",score),document.cookie="index="+counter+"; path=/",document.cookie="seq=0; path=/",$(".level").text(lv_store),$(".scoretxt").text(score),$(".countertxt").text("#"+counter),$.ajax({url:URL+"resetgame",type:"POST",tryCount:0,retryLimit:10,tryCount2:0,retryLimit2:3,headers:{"X-CSRFToken":d("csrftoken")},success:function(e){"success"==e&&location.reload()},error:function(e,t,i){"error"==t&&0==e.status?(this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)):(this.tryCount2++,this.tryCount2<=this.retryLimit2&&$.ajax(this))}})}function d(e){var t=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),o=0;o<i.length;o++){var n=jQuery.trim(i[o]);if(n.substring(0,e.length+1)==e+"="){t=decodeURIComponent(n.substring(e.length+1));break}}return t}function c(){var e=$(".tracker").width()-$(".duration").width()-25;$(".progressBar").css({width:e})}switch($("#pause1").hide(),$("#buffer1").hide(),$("#pause2").hide(),$("#buffer2").hide(),o(t=$("#playlist1 li:first-child"),"player1"),o(i=$("#playlist2 li:first-child"),"player2"),$("#play1").click(function(){if(n.paused){var e=$("#progress1").attr("curtime");if(void 0!==e&&!1!==e)return o(t,"player1"),n.currentTime=parseFloat(e),n.play(),$("#play1").hide(),$("#buffer1").hide(),$("#pause1").show(),$("#duration1").fadeIn(400),void r(1)}else 0<n.duration&&$("#pause2").trigger("click");o(t,"player1"),n.play(),n.addEventListener("loadstart",function(){$("#play1").hide(),$("#pause1").hide(),$("#buffer1").show()}),n.addEventListener("loadedmetadata",function(){$("#play1").hide(),$("#buffer1").hide(),$("#pause1").show()}),$("#duration1").fadeIn(400),r(1)}),$("#play2").click(function(){if(n.paused){var e=$("#progress2").attr("curtime");if(void 0!==e&&!1!==e)return o(i,"player2"),n.currentTime=parseFloat(e),n.play(),$("#play2").hide(),$("#buffer2").hide(),$("#pause2").show(),$("#duration2").fadeIn(400),void r(2)}else 0<n.duration&&$("#pause1").trigger("click");o(i,"player2"),n.play(),n.addEventListener("loadstart",function(){$("#play2").hide(),$("#pause2").hide(),$("#buffer2").show()}),n.addEventListener("loadedmetadata",function(){$("#play2").hide(),$("#buffer2").hide(),$("#pause2").show()}),$("#duration2").fadeIn(400),r(2)}),$("#pause1").click(function(){n.pause(),$("#progress1").attr("curtime",n.currentTime),$("#pause1").hide(),$("#play1").show()}),$("#pause2").click(function(){n.pause(),$("#progress2").attr("curtime",n.currentTime),$("#pause2").hide(),$("#play2").show()}),$("#multiplecheck").on("change",function(e){$(this).prop("checked")?($("#multiplecheck").attr("ismultiple","true"),$(".optionsblock").slideDown(300)):($("#multiplecheck").attr("ismultiple","false"),$(".optionsblock").slideUp(300))}),$("#consentCheckBox").on("change",function(e){this.checked?$(".submitinfo").prop("disabled",!1):$(".submitinfo").prop("disabled",!0)}),$(".lighttheme").on("click",function(e){$.ajax({url:URL+"themechange",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{theme:"light"},success:function(e){location.reload()}})}),$(".darktheme").on("click",function(e){$.ajax({url:URL+"themechange",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{theme:"dark"},success:function(e){location.reload()}})}),$(".loginbtn").click(function(){var e=$.trim($("#uname").val()),t=$.trim($("#pass").val());$.ajax({url:URL+"login",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{username:e,password:t}}).done(function(e){"success"==e?($("#loginModal").modal("toggle"),location.reload()):$(".loginfailed").css("display","block")})}),$(".saveSettings").click(function(){$(".errordiv").css("display","none");var e,t,i,o,n,r,a,s=$("#multiplecheck").prop("checked"),l=$("#choices-list-item").val(),c=$("#instruction-txt").val(),d=$(".samepoint").val(),u=$(".differentpoint").val(),p=$(".setting-btn").attr("selectedval"),f=localStorage.getItem("temp");if(!f&&(l||d||u))return $(".errortxt").text("Please add option to the list and then save"),$(".errordiv").css("display","block"),void $("#settingModal").scrollTop(1e3);$.isEmptyObject(uploadfile)?"none"!=$(".imgPreview").css("background-image")&&((e=function(e){var t="",i=e.split("/").pop().split(".").pop();-1<$.inArray(i,["gif","jpg","jpeg","png"])&&(t=e);return t}($(".imgPreview").css("background-image").replace(/^url\(['"](.+)['"]\)/,"$1")))?$.when((o=i=null,n=(t=e).split("/").pop(),r=$.Deferred(),(a=new XMLHttpRequest).open("GET",t,!0),a.responseType="blob",a.send(),a.onload=function(){i=a.response,o=new File([i],n),r.resolve(o)},r.promise())).done(function(e){h(e,s,l,c,d,u,p,f)}):h("",s,l,c,d,u,p,f)):(t=(e=uploadfile).type,-1<$.inArray(t,["image/gif","image/jpeg","image/png"])&&h(e,s,l,c,d,u,p,f))}),$(".opennewsetting").click(function(){$("#settingModal").removeClass("fade"),$("#settingModal").modal("hide"),$("#settingnameModal").modal("show"),$("#setsettingname").val("")}),$("#settingnameModal").on("shown.bs.modal",function(e){$(".settingerrdiv").css("display","none")}),$("#settingnameModal").on("hidden.bs.modal",function(e){$("#settingModal").modal("show"),$("#settingModal").addClass("fade")}),$(".setsettingbtn").on("click",function(){var e=$("#setsettingname").val(),t=$(".setting-btn").attr("selectedval"),i=localStorage.getItem("setlist"),o=$(".settingerr"),n=$(".settingerrdiv");$(".errordiv").css("display","none"),$.when(a(i,e,o,n)).done(function(){$(".setting-btn").text(e),$(".setting-btn").attr("selectedval",e),$(".setting-btn").attr("newset",e),t&&$(".settingdropdownoptions").append("<a class='dropdown-item othersettings' href='#'>"+t+"</a>"),$("#settingnameModal").modal("toggle"),$("#list-items").empty()})}),$(".btn-exit").click(function(){$.ajax({url:URL+"generatetoken",type:"POST",tryCount:0,retryLimit:10,tryCount2:0,retryLimit2:3,headers:{"X-CSRFToken":d("csrftoken")},success:function(e){$("#uniquetoken").val(e.token),$("#totalhits").val(e.hits),$("#exitModal").modal("show")},error:function(e,t,i){"error"==t&&0==e.status?(this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)):(this.tryCount2++,this.tryCount2<=this.retryLimit2&&$.ajax(this))}})}),$(".copybtn").click(function(){$("#uniquetoken").select(),document.execCommand("copy")}),$(".copyexittoken").click(function(){$("#exitToken").select(),document.execCommand("copy")}),$("#randomizeToggle").change(function(){$("#randomizeToggle").prop("checked")?($("#shuffleToggle").prop("checked",!1),$("#shuffleToggle").prop("disabled",!0)):$("#shuffleToggle").prop("disabled",!1)}),$(".checkvalidity").on("click",function(){var e=$("#wtoken").val(),l=$("#mturkwid").val();(e||l)&&$.ajax({url:URL+"getdatabytoken",type:"POST",data:{workertoken:e,workerid:l},headers:{"X-CSRFToken":d("csrftoken")},success:function(e){var t,i,o,n,r,a,s;e&&"error"!=Object.keys(e)[0]?(t=e.tscore||"",i=e.ttime||"",o=e.mtwid||"",n=e.tcount||"",r=e.wscore||"",a=e.wtime||"",s=e.wcount||"",$("#storedwid").val(o),$("#wscore").val(t),$("#timespent").val(i),$("#ttotaltrials").val(n),$("#scorebywid").val(r),$("#timespentbywid").val(a),$("#wtotaltrials").val(s),o==l?$(".verifyworker").css("display","block"):$(".verifyworker").css("display","none")):($(".mtverifyerr").text(e.error),$(".mtverifyerrdiv").css("display","block"))}})}),$(".clearbtn").on("click",function(){$("#wtoken").val(""),$("#mturkwid").val(""),$("#storedwid").val(""),$("#wscore").val(""),$("#timespent").val(""),$("#ttotaltrials").val(""),$("#scorebywid").val(""),$("#timespentbywid").val(""),$("#wtotaltrials").val(""),$(".mtverifyerr").text(""),$(".mtverifyerrdiv").css("display","none"),$(".verifyworker").css("display","none")}),$("body").on("click",".othersettings",function(){var e,t=$(this).text(),i=$(".setting-btn").attr("selectedval"),o=JSON.parse(localStorage.getItem(t));$("#list-items").empty(),$("#list-items").html(o.table),$("#instruction-txt").text(o.ins[0].text),$(".imgPreview").css("background-image","url("+o.ins[0].url+")"),o.ins[0].url?$(".imgicn").hide():$(".imgicn").show(),$(".setting-btn").text(t),$(".setting-btn").attr("selectedval",t),$(".setting-btn").attr("set",o.set),"sequential"===o.rand?$("#randomizeToggle").bootstrapToggle("off"):"randomize"===o.rand?$("#randomizeToggle").bootstrapToggle("on"):"shuffle"===o.rand&&($("#randomizeToggle").bootstrapToggle("off"),$("#shuffleToggle").prop("checked",!0)),0<$(".uploadAudioList")[0].files.length?(e=$(".uploadAudioList")[0].files[0],$("#list-txt").text(e.name)):$("#list-txt").text(o.aud.split("/")[1]),0<$(".uploadAudioScore")[0].files.length?(e=$(".uploadAudioScore")[0].files[0],$("#score-txt").text(e.name)):$("#score-txt").text(o.sco.split("/")[1]),$(".othersettings").filter(function(){return $(this).text()===t}).remove(),i&&$(".settingdropdownoptions").prepend("<a class='dropdown-item othersettings' href='#'>"+i+"</a>")}),$(document).on("change",".uploadImage",function(){var e,t;this.files&&(t=(e=this.files[0]).type,-1<$.inArray(t,["image/gif","image/jpeg","image/png"])&&(uploadfile=e,(t=new FileReader).readAsDataURL(e),t.onloadend=function(e){$(".imgPreview").css("background-image","url("+e.target.result+")"),$(".imgicn").hide()}))}),$(document).on("change",".uploadAudioList",function(){var e,t;$(".errordiv").css("display","none"),!this.files||(e=this.files[0])&&(t=e.type,-1<$.inArray(t,["text/plain"])?($("#list-txt").text(e.name),validAudioList=!0):(validAudioList=!1,$("#list-txt").text("No file"),$(".errortxt").text("Invalid file type. Please upload .txt file"),$(".errordiv").css("display","block"),$("#settingModal").scrollTop(1e3)))}),$(document).on("change",".uploadAudioScore",function(){var e;$(".errordiv").css("display","none"),!this.files||(e=this.files[0])&&("npy"===(e=e.name).split(".").pop()?($("#score-txt").text(e),validScoreFile=!0):(validScoreFile=!1,$("#score-txt").text("No file"),$(".errortxt").text("Invalid file type. Please upload .npy file"),$(".errordiv").css("display","block"),$("#settingModal").scrollTop(1e3)))}),$(".dltImage").click(function(){$(".imgPreview").css("background-image","url('')"),uploadfile={},$(".imgicn").show()}),$(".rename-set").click(function(){$(".setting-btn").removeClass("dropdown-toggle"),$(".setting-btn").prop("contenteditable",!0),$(".setting-btn").removeAttr("data-toggle"),$(".setting-btn").focus(),$(".setting-btn").css("cursor","initial"),$(this).hide(),$(".add-set").hide(),$(".downloadreport").hide(),$(".done-rename").show(),$(".cancel-rename").show(),$(".settingdropdown .dropdown-menu").hide()}),$(".cancel-rename").click(function(){s(),$(".setting-btn").text($(".setting-btn").attr("selectedval"))}),$(".done-rename").click(function(){var e=$(".setting-btn").text(),t=$(".setting-btn").attr("selectedval"),i=localStorage.getItem("setlist"),o=$(".errortxt"),n=$(".errordiv");if($(".errordiv").css("display","none"),!e)return o.text("Setting name not valid!"),n.css("display","block"),void $("#settingModal").scrollTop(1e3);$.when(a(i,e,o,n)).done(function(){$.ajax({url:URL+"renamesetting",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{newname:e,oldname:t}}).done(function(e){"success"==Object.keys(e)[0]?(s(),$(".setting-btn").text(e.success)):"error"==Object.keys(e)[0]&&($(".errortxt").text(e.error),$(".errordiv").css("display","block"),$("#settingModal").scrollTop(1e3))}).fail(function(e){console.log("Server Error")})}),s(),$(".setting-btn").text($(".setting-btn").attr("selectedval"))}),$(".downloadreport").click(function(){var e=$(".setting-btn").text();window.location=URL+"downloadreport?setting="+e}),$(".continuebtn").click(function(){location.reload(),$("#levelsuccessModal").modal("hide")}),$(".retrybtn").click(function(){location.reload(),$("#levelfailModal").modal("hide")}),$(".resetgame").click(function(){l()}),$(".restartbtn").click(function(){l()}),$(".submitfeedback").click(function(){var e=$.trim($("#feedrating").val()),t=$.trim($("#feedlike").val()),i=$.trim($("#feeddislike").val());$.ajax({url:URL+"feedback",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{rating:e,likefeed:t,dislikefeed:i}}).done(function(e){"success"==e?$("#feedbackModal").modal("hide"):console.log("Error saving feedback")})}),$(".submitinfo").click(function(){var e=$.trim($("#infoexperience").val()),t=$.trim($("#infolanguage").val()),i=$.trim($("#infodisability").val()),o=$.trim($("#infospeaker").val()),n=$.trim($("#infobackground").val()),r=$.trim($("#infodevice").val());$.ajax({url:URL+"playerinfo",type:"POST",headers:{"X-CSRFToken":d("csrftoken")},data:{infoexp:e,infolang:t,infodisability:i,infospeaker:o,infobackground:n,infodevice:r}}).done(function(e){"success"==e?($("#infodataModal").modal("hide"),localStorage.setItem("infochecked","true")):console.log("Error saving participant's info")})}),document.readyState){case"loading":$(".loader2").fadeIn(1e3);break;case"complete":$(".loader2").hide()}var e=setInterval(function(){switch(document.readyState){case"loading":$(".loader2").fadeIn(1e3);break;case"complete":$(".loader2").hide(),clearInterval(e)}},100);$(document).ready(function(){c(),$(".leftblock").animate({left:"0"}),$(".rightblock").animate({right:"0"}),$("#confslider").val(0),$("#confidencescore").val(0),$(".btnnext").prop("disabled",!0),$(".addlisttxt").attr("autocomplete","off"),$(".txtbox").attr("autocomplete","off");var e=maxlv,t=localStorage.getItem("prevscore"),t=t?parseFloat(t):0;1==counter&&(t=score,localStorage.setItem("prevscore",t)),isGamified?(1<lv_store?$(".btn-exit").removeClass("disabled"):$(".btn-exit").addClass("disabled"),$(".gameovertitle").text("Game Over!"),$(".exitgametitle").text("Exit Game")):($(".levelwrap").css({"padding-bottom":"35px"}),10<counter?$(".btn-exit").removeClass("disabled"):$(".btn-exit").addClass("disabled"),$(".choicesradiobtns").find("input").prop("checked",!1),$(".gameovertitle").text("Survey Complete"),$(".exitgametitle").text("Exit Survey")),isGamified?0<lv_store&&lv_store<=e?counter>totaltrials&&($(".completelv").text(lv_store),counter=1,localStorage.setItem("counter",counter),document.cookie="index="+counter+"; path=/",localStorage.setItem("prevscore",score),lv_store==e&&($(".levelmsg").text("You have reached max level"),$(".continuebtn").text("Play Again"),$("#gameOverModal").modal("show"),document.cookie="_flg=1; path=/"),lv_store<e&&(lv_store++,t=lv_store,$.ajax({url:URL+"setlevel",type:"POST",data:{level:t},tryCount:0,retryLimit:10,tryCount2:0,retryLimit2:3,headers:{"X-CSRFToken":d("csrftoken")},success:function(e){if("success"==e)return e},error:function(e,t,i){"error"==t&&0==e.status?(this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)):(this.tryCount2++,this.tryCount2<=this.retryLimit2&&$.ajax(this))}}),$("#levelsuccessModal").modal("show"))):l():(e=e*totaltrials,counter>e&&($("#gameOverModal").modal("show"),document.cookie="_flg=1; path=/")),$("#confidencescore").focusout(function(){var e=parseInt($("#confidencescore").val());100<e&&$("#confidencescore").val(100),e<0&&$("#confidencescore").val(0)}),$(".choicesradiobtns").on("click",function(){inputbtn=$(this).children("input"),inputbtn.prop("checked",!0),selectedbtn=inputbtn,selectedchoice=$.trim(inputbtn.attr("choice")),selectedsp=parseFloat(inputbtn.attr("choicesp")),selecteddp=parseFloat(inputbtn.attr("choicedp")),0<parseInt($("#confidencescore").val())&&$(".btnnext").prop("disabled",!1)}),$(".txtbox").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(".loginbtn").click())}),$(".addlisttxt").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(".add").click())}),$("#setsettingname").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(".setsettingbtn").click())}),$("#wtoken").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(".checkvalidity").click())}),$(".innerbutton").hover(function(){$(this).parent().find(".triangle-left").delay(50).queue(function(e){$(this).addClass("darkback-left"),e()}),$(this).parent().find(".triangle-right").delay(50).queue(function(e){$(this).addClass("darkback-right"),e()})},function(){$(".triangle-left").delay(50).queue(function(e){$(this).removeClass("darkback-left"),e()}),$(".triangle-right").delay(50).queue(function(e){$(this).removeClass("darkback-right"),e()})}),$(".fb-star").mouseenter(function(){$(this).addClass("fillstar"),$(this).css({"font-size":"14px","text-shadow":"-1px 0 #17b6e5, 0 1px #17b6e5, 1px 0 #17b6e5, 0 -1px #17b6e5",cursor:"pointer"}),$(this).prevAll(".fb-star").addClass("fillstar"),$(this).prevAll(".fb-star").css({"font-size":"14px","text-shadow":"none"}),$(this).nextAll(".fb-star").removeClass("fillstar"),$(this).nextAll(".fb-star").css({"font-size":"14px","text-shadow":"none"})}),$(".fb-star").mouseleave(function(){var e=$(this).parent().find('[selected="selected"]');0<e.length?(e.addClass("fillstar"),e.prevAll(".fb-star").addClass("fillstar"),e.prevAll(".fb-star").css({"font-size":"14px","text-shadow":"none"}),e.nextAll(".fb-star").removeClass("fillstar"),e.nextAll(".fb-star").css({"font-size":"14px","text-shadow":"none"})):$(this).parent().find(".fb-star").removeClass("fillstar")}),$(".fb-star[title]").tooltip(),$(".fb-star").on("click",function(){$(this).parent().find('[selected="selected"]').removeAttr("selected"),$(this).attr("selected","selected"),$(this).addClass("fillstar"),$(this).prevAll(".fb-star").addClass("fillstar"),$(this).prevAll(".fb-star").css({"font-size":"14px","text-shadow":"none"});var e=$(this).parent().attr("class"),t=$(this).attr("data-original-title"),i=$(this).attr("i");$.ajax({url:URL+"setrating",type:"POST",data:{field:e,txt:t,value:i},tryCount:0,retryLimit:10,tryCount2:0,retryLimit2:3,headers:{"X-CSRFToken":d("csrftoken")},success:function(e){if("success"==e)return e},error:function(e,t,i){"error"==t&&0==e.status?(this.tryCount++,this.tryCount<=this.retryLimit&&$.ajax(this)):(this.tryCount2++,this.tryCount2<=this.retryLimit2&&$.ajax(this))}})}),$(".txtbox").focusin(function(){$(this).parent().find(".iconbox").css({"padding-left":"35px"}),$(".loginfailed").css("display","none")}),$(".txtbox").focusout(function(){$(this).parent().find(".iconbox").css({"padding-left":"50px"})}),$(".txtbox").hover(function(){$(this).parent().find(".iconbox").css({color:"#0069d9"})},function(){$(this).parent().find(".iconbox").css({color:"#666666"})})}),$(window).resize(c);